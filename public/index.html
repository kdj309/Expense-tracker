<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous" />
    <script src="https://kit.fontawesome.com/da4c99d782.js" crossorigin="anonymous"></script>

    <title>Expense Tracker</title>
    <style>
        body table {
            margin-top: 20px;
        }
        #edit{
            cursor: pointer;
        }
        @media (max-width:656px) {
            nav{
                width: 478px ;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">MoneyTracker</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="About.html">ABOUT</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    </a>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0">
                <input id="searchTxt" class="form-control mr-sm-2" type="search" placeholder="Search"
                    aria-label="Search" />
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">
                    Search
                </button>
            </form>
        </div>
    </nav>
    <div class="container center">
        <div class="form-group">
            <form action="" id="myform">
                <label for="Expense">Expense</label>
                <input type="text" class="form-control" id="Expense" aria-describedby="emailHelp" />
                <small id="emailHelp" class="form-text text-muted">Enter your Expense Reason.</small>
        </div>
        <div class="form-group">
            <label for="Date">Date</label>
            <input type="date" class="form-control" id="Date" />
        </div>
        <div class="form-group">
            <label for="Amount">Amount</label>
            <input type="number" class="form-control" id="Amount" />
        </div>
        <input type="hidden" id="getindex"/>
        <button style="margin: 5px;" id="mainbtn1" onclick="flash()" value="remove all" class="btn btn-danger">remove all</button>
        <br>
        <button style="margin: 5px;" id="mainbtn" type="submit" class="btn btn-primary">Submit</button>
        <button style="margin: 5px;" id="mainbtn2" type="button" class="btn btn-primary">save</button>
        </form>
    </div>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Sl.no</th>
                <th scope="col">Expense</th>
                <th scope="col">Date</th>
                <th scope="col">Amount</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody id="tablebody">
            <tr id="tr1">
                <th scope="row">1</th>
                <td>Dress shoping</td>
                <td>30/6/2020</td>
                <td>1500</td>
                <td>
                    <button onclick="delt()" value="delete" class="btn btn-primary">
                        Delete
                    </button>
                </td>
                <td><i id="edit"  class="fas fa-edit"></i>Edit</td>
            </tr>
        </tbody>
    </table>
    <button id="mainbtn2" onclick="total()" style="margin: 7px;" class="btn btn-primary">Total</button>
    <div style="display: flex;gap: 10px;">
        <h3 style="display: inline;" id="total"></h3>
    </div>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
    <script>
        document.getElementById("mainbtn2").style.display="none"
        document.getElementById("myform").addEventListener("submit", (e) => {
            e.preventDefault()
            let Expense = document.getElementById("Expense").value;
            let date = document.getElementById("Date").value;
            let amount = document.getElementById("Amount").value;
            if (Expense.length==0 || date.length==0 || amount.length==0) {
               alert("please don't leave input value empty") 
            }
            else{
                if (localStorage.getItem("itemjson") == null) {
                let Expense = document.getElementById("Expense").value;
                let date = document.getElementById("Date").value;
                let amount = document.getElementById("Amount").value;
                itemjsonarry = [];
                itemjsonarry.push([Expense, date, amount]);
                localStorage.setItem("itemjson", JSON.stringify(itemjsonarry));
            } else {
                let Expense = document.getElementById("Expense").value;
                let date = document.getElementById("Date").value;
                let amount = document.getElementById("Amount").value;
                itemjsonarry = JSON.parse(localStorage.getItem("itemjson"));
                itemjsonarry.push([Expense, date, amount]);
                localStorage.setItem("itemjson", JSON.stringify(itemjsonarry));
            }
            update();
            document.getElementById("myform").reset()
            } 
        })

        function update() {
            if (localStorage.getItem("itemjson") == null) {
                itemjsonarry = [];
                localStorage.setItem("itemjson", JSON.stringify(itemjsonarry));
            } else {
                itemjsonarry = JSON.parse(localStorage.getItem("itemjson"));
            }
            str = "";
                itemjsonarry.forEach((element, index) => {
                str += `
              <tr class="items" id="tr1">
                <th scope="row">${index + 1}</th>
                <td>${element[0]}</td>
                <td>${element[1]}</td>
                <td>${element[2]}</td>
                <td><button onclick="remove(${index})" value="delete" class="btn btn-primary">Delete</button></td>
                <td><i id="edit" onclick="edit(${index})"  class="fas fa-edit"> Edit</i></td>
            </tr>
              `;
            });
            document.getElementById("tablebody").innerHTML = str;
            let Expense = document.getElementById("Expense").value
            let date = document.getElementById("Date").value
            let amount = document.getElementById("Amount").value;
            Expense = " "
            date = " "
            amount = " "
        }
        function edit(itemindex) {
            document.getElementById("mainbtn2").style.display="block"
            document.getElementById("mainbtn").style.display="none"
            document.getElementById("Expense").value=itemjsonarry[itemindex][0]
            document.getElementById("Date").value=itemjsonarry[itemindex][1]
            document.getElementById("Amount").value=itemjsonarry[itemindex][2]
            let savebtn=document.getElementById("getindex")
            savebtn.value=itemindex
            itemjsonarry = JSON.parse(localStorage.getItem("itemjson"));
           
            //console.log(Expense)
            // itemjsonarry.splice(itemindex, 1);
            // localStorage.setItem("itemjson", JSON.stringify(itemjsonarry));
        }
        document.getElementById("mainbtn2").addEventListener("click",adjust)
        function adjust() {
            itemjsonarry = JSON.parse(localStorage.getItem("itemjson"));
            let index=document.getElementById("getindex").value
            console.log(index)
            itemjsonarry[index][0]=document.getElementById("Expense").value;
            itemjsonarry[index][1]=document.getElementById("Date").value;
            itemjsonarry[index][2]=document.getElementById("Amount").value;
            localStorage.setItem("itemjson", JSON.stringify(itemjsonarry));
            document.getElementById("mainbtn2").style.display="none"
            document.getElementById("mainbtn").style.display="block"
            console.log(itemjsonarry)
            update()
            document.getElementById("Expense").value=" "
            document.getElementById("Date").value=" "
            document.getElementById("Amount").value=" "
        }
        function remove(itemindex) {
            itemjsonarry = JSON.parse(localStorage.getItem("itemjson"));
            itemjsonarry.splice(itemindex, 1);
            localStorage.setItem("itemjson", JSON.stringify(itemjsonarry));
            update();
        }
        function flash() {
            if (confirm("it will delete all expenses")) {
                localStorage.clear();
                document.getElementById("total").innerText = ""
                update();
            }
        }
        function delt() {
            document.getElementById("tr1").style.display = "none";
        }
        let Search = document.getElementById("searchTxt");
        Search.addEventListener("input", function () {
            let inputval = Search.value.toLowerCase();
            let item = document.getElementsByClassName("items");
            Array.from(item).forEach(function (element) {
                let card = element.getElementsByTagName("td")[0].innerText;
                card.includes(inputval)?element.style.display = "table-row":element.style.display = "none";
            });
        });
        function total() {
            itemjsonarry=JSON.parse(localStorage.getItem("itemjson"))
            //console.log(b);
            let expenses = itemjsonarry.map((expense) => {
                let values = parseInt(expense[2])
                return values
            });
            //console.log(expenses);
            let totalexpense = expenses.reduce(function (total, exp) {
                return total + exp;
            }, 0);
            localStorage.setItem("itemjson", JSON.stringify(itemjsonarry));
            document.getElementById("total").innerText = totalexpense
            console.log(itemjsonarry)
        }
    </script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="/__/firebase/8.6.3/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="/__/firebase/8.6.3/firebase-analytics.js"></script>

<!-- Initialize Firebase -->
<script src="/__/firebase/init.js"></script>
</body>

</html>